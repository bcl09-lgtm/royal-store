<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCL Core | Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --s-bg: #f6f6f7; --s-text: #1a1c1d; --s-accent: #008060;
            --s-sidebar: #1a1c1d; --s-white: #ffffff; --s-border: #d2d5d8;
            --danger: #d72c0d;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: var(--s-bg); color: var(--s-text); height: 100vh; overflow: hidden; }

        /* --- Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† --- */
        #auth_gate {
            position: fixed; inset: 0; background: #000; z-index: 100000;
            display: flex; align-items: center; justify-content: center;
        }
        .login-card {
            background: #111; padding: 50px; border-radius: 20px; border: 1px solid #222;
            text-align: center; width: 400px;
        }
        .login-card input {
            width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #333;
            background: #000; color: white; font-size: 20px; text-align: center; margin-bottom: 20px;
        }
        .login-card button {
            width: 100%; padding: 15px; background: var(--s-accent); color: white;
            border: none; border-radius: 10px; font-weight: 900; cursor: pointer;
        }

        /* --- Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ --- */
        #bcl_system { display: none; height: 100vh; }
        .app-layout { display: flex; height: 100vh; }

        aside {
            width: 260px; background: var(--s-sidebar); color: #ccc;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden;
            display: flex; flex-direction: column; white-space: nowrap;
        }
        aside.collapsed { width: 0; padding: 0; }

        .aside-header { color: white; font-weight: 900; font-size: 22px; padding: 30px 20px; cursor: pointer; }
        .nav-group { flex: 1; display: none; padding: 0 10px; }
        .nav-group.visible { display: block; }
        
        .nav-link {
            padding: 12px 15px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px; margin-bottom: 5px;
        }
        .nav-link:hover { background: rgba(255,255,255,0.1); color: white; }

        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        header {
            height: 60px; background: white; border-bottom: 1px solid var(--s-border);
            display: flex; justify-content: space-between; align-items: center; padding: 0 20px;
        }

        .scroll-area { flex: 1; overflow-y: auto; padding: 30px; }
        .data-card { background: white; border: 1px solid var(--s-border); border-radius: 12px; padding: 20px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: right; font-size: 12px; color: #666; padding: 10px; border-bottom: 2px solid var(--s-bg); }
        td { padding: 15px 10px; border-bottom: 1px solid var(--s-bg); font-size: 14px; }
    </style>
</head>
<body>

    <div id="auth_gate">
        <div class="login-card" id="gate_box">
            <h1 style="color:var(--s-accent); margin-bottom:20px;">BCL MASTER</h1>
            <input type="password" id="passCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠ">
            <button onclick="login()">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
            <p id="errorMsg" style="color:red; margin-top:15px; font-size:12px; font-weight:700;"></p>
        </div>
    </div>

    <div id="bcl_system">
        <div class="app-layout">
            <aside id="mainSidebar">
                <div class="aside-header" onclick="toggleSubMenu()">BCL COMMAND â–¾</div>
                
                <div id="linksContainer" class="nav-group">
                    <div class="nav-link" onclick="fetchTemplates()">ğŸ“¡ Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ (Live)</div>
                    <div class="nav-link">ğŸª Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©</div>
                    <div class="nav-link">ğŸ’ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ§Øª</div>
                    <div class="nav-link">ğŸ”— API Settings</div>
                    <div class="nav-link">ğŸ“‚ Logs</div>
                </div>

                <div class="nav-link" style="margin-top:auto; color:var(--danger); padding:20px;" onclick="location.reload()">ğŸ”’ Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†</div>
            </aside>

            <main>
                <header>
                    <div style="display:flex; align-items:center; gap:15px;">
                        <button onclick="toggleSidebar()" style="background:none; border:none; font-size:20px; cursor:pointer;">â˜°</button>
                        <span id="db_status" style="font-size:12px; font-weight:bold; color:orange;">Connecting...</span>
                    </div>
                    <div id="liveTime" style="font-weight:bold;">00:00:00</div>
                </header>

                <div class="scroll-area">
                    <div id="view_title" style="margin-bottom:20px;">
                        <h2 style="font-weight:900;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù‚Ø§Ø¦Ø¯</h2>
                        <p style="color:#666;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ù…ØªØµÙ„Ø© Ø¨Ù€ Supabase Ø¨Ù†Ø¬Ø§Ø­.</p>
                    </div>

                    <div id="mainContent" class="data-card">
                        <p>Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©...</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ---
        const SB_URL = "https://ikewpivxeqhgcmdusgro.supabase.co";
        const SB_KEY = "sb_publishable_Y2GIN3b5fhRacM0L5VJ1iw_hA5gtsuF";
        const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

        let tries = 5;

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø­Ø¸Ø±
        function login() {
            if(localStorage.getItem('sys_banned')) return;
            const code = document.getElementById('passCode').value;
            if(code === "BCL-2025") {
                document.getElementById('auth_gate').style.display = 'none';
                document.getElementById('bcl_system').style.display = 'block';
                checkDB();
            } else {
                tries--;
                document.getElementById('errorMsg').innerText = `Ø®Ø·Ø£! Ù…ØªØ¨Ù‚ÙŠ ${tries} Ù…Ø­Ø§ÙˆÙ„Ø§Øª`;
                if(tries <= 0) {
                    localStorage.setItem('sys_banned', 'true');
                    document.getElementById('gate_box').innerHTML = "<h2 style='color:red'>BANNED</h2>";
                }
            }
        }

        // ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        async function checkDB() {
            const { data, error } = await supabaseClient.from('templates').select('id').limit(1);
            const status = document.getElementById('db_status');
            if(error) {
                status.innerText = "Connection Error"; status.style.color = "red";
            } else {
                status.innerText = "Supabase Live â—"; status.style.color = "var(--s-accent)";
            }
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ù…Ù† SQL
        async function fetchTemplates() {
            const content = document.getElementById('mainContent');
            content.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...";
            
            let { data: templates, error } = await supabaseClient.from('templates').select('*');
            
            if(error) {
                content.innerHTML = "Ø®Ø·Ø£: " + error.message;
            } else {
                let tableHtml = `<table><thead><tr><th>Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨</th><th>Ø§Ù„ÙØ¦Ø©</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</th></tr></thead><tbody>`;
                templates.forEach(t => {
                    tableHtml += `<tr><td><b>${t.name}</b></td><td>${t.category}</td><td>${new Date(t.created_at).toLocaleDateString()}</td></tr>`;
                });
                tableHtml += `</tbody></table>`;
                content.innerHTML = tableHtml;
            }
        }

        // ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        function toggleSidebar() { document.getElementById('mainSidebar').classList.toggle('collapsed'); }
        function toggleSubMenu() { document.getElementById('linksContainer').classList.toggle('visible'); }

        // Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø­ÙŠ
        setInterval(() => {
            document.getElementById('liveTime').innerText = new Date().toLocaleTimeString('ar-DZ');
        }, 1000);

        if(localStorage.getItem('sys_banned')) document.getElementById('gate_box').innerHTML = "<h2 style='color:red'>BANNED</h2>";
    </script>
</body>
</html>

